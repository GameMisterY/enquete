{{ define "main" }}
  {{ $pages := .Pages }}
  {{ $pages = sort $pages ".Params.order"}}
  {{ $first_page := index $pages 0 }}


  <div class="lock">
    <div class="lock-zone">
      <div class="lock-description">
        {{ .Content }}
      </div>

      <form id="lock-form" class="lock-form" autocomplete="off">
        <input type="text" id="pw" name="pw" placeholder={{ .Params.placeholder }} />
        <button type="submit" class="lock-submit-button"></button>
      </form>
      <div id="message" class="lock-message"></div>
      <blockquote>
      {{if not (isset .Params "password") }}
        document.addEventListener('DOMContentLoaded', function() {
          window.location.href = "{{$first_page.RelPermalink}}";
        });
      {{ end }}

      const passwordInput = document.getElementById('pw');
      const messageBox = document.getElementById('message');

      document.getElementById('lock-form').addEventListener('submit', function(event) {
        event.preventDefault();

        let password = "{{ .Params.password }}";

        if(passwordInput.value.trim() === password){

          messageBox.textContent = "{{ .Params.success_message }}";
          messageBox.className = 'lock-message';
          messageBox.classList.add('success', 'show');

          setTimeout(() => {
            window.location.href = "{{$first_page.RelPermalink}}";
          }, 1000);
        } else {

          messageBox.textContent = "{{ .Params.error_message }}";
          messageBox.className = 'lock-message';
          messageBox.classList.add('error', 'show');

          passwordInput.value = '';
          passwordInput.focus();
        }
      });

      passwordInput.addEventListener('input', () => {
        if (messageBox.classList.contains('error')) {
          messageBox.className = 'lock-message';
          messageBox.textContent = '';
        }
      });
    </blockquote>
    </div>

  </div>
  <script>
    {{if not (isset .Params "password") }}
      document.addEventListener('DOMContentLoaded', function() {
        window.location.href = "{{$first_page.RelPermalink}}";
      });
    {{ end }}

    const passwordInput = document.getElementById('pw');
    const messageBox = document.getElementById('message');

    document.getElementById('lock-form').addEventListener('submit', function(event) {
      event.preventDefault();

      let password = "{{ .Params.password }}";
      alert(
            "Le mot de passe entrée est: " + passwordInput.value.trim() + "\n"+
            "Le mot de passe attendu est: " + password + "\n" +
            "Egalité: " + (passwordInput.value.trim() === password) + "\n" +
            "Test1: " + "{{ .Params.password }}" + "\n" +
            "Test2: " + "{{ .Params.password | jsonify }}" + "\n" +
            "Test3: " + "{{ printf "%q" .Params.password }}" + "\n"
      );
      if(passwordInput.value.trim() === password){

        messageBox.textContent = "{{ .Params.success_message }}";
        messageBox.className = 'lock-message';
        messageBox.classList.add('success', 'show');

        setTimeout(() => {
          window.location.href = "{{$first_page.RelPermalink}}";
        }, 1000);
      } else {

        messageBox.textContent = "{{ .Params.error_message }}";
        messageBox.className = 'lock-message';
        messageBox.classList.add('error', 'show');

        passwordInput.value = '';
        passwordInput.focus();
      }
    });

    passwordInput.addEventListener('input', () => {
      if (messageBox.classList.contains('error')) {
        messageBox.className = 'lock-message';
        messageBox.textContent = '';
      }
    });
  </script>
  <style>

  .lock {
    /*background-image: url( {-{ $background_image.Permalink  }});
    background-attachment: fixed;
    background-position: center 0px;
    background-size: cover;
    background-repeat: no-repeat;*/

    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  .lock-zone {
    display: flex;
    flex-direction: column;
    background-color: #00000040;
    padding: 100px 200px;
    border-radius: 20px;
    margin-bottom: 200px;
  }

  .lock-description {
    margin-bottom:3rem;
    font-size: 2rem;
    color: white;
    text-align: center;
    word-break: break-word;
  }

  .lock-form {
    position:relative;
    display:flex;
    justify-content:center;
  }

  .lock-form input {
    width: 100%;
    padding: 1rem 3.5rem 1rem 1rem;
    text-align: center;
    border-radius:80px;
    font-size:2rem;
    outline:none;
    border:3px solid transparent;
    transition:border-color .2s;
    height: 2rem;
  }

  .lock-form input:focus {
    border:3px solid #888;
  }

  .lock-submit-button{
    position:absolute;
    right:0.5rem;
    top:50%;
    transform:translateY(-50%);
    width:3.5rem;
    height:3.5rem;
    border:none;
    border-radius:50%;
    background:#ee0022;
    color:#fff;
    cursor:pointer;
    font-size:1.2rem;
    line-height:0;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:background .2s;
  }

  .lock-submit-button:hover{
    background:#aa0022;
  }

  .lock-submit-button::after{
    content:"➔";
    font-weight:bold;
  }

  .lock-message{
    margin-top:0.8rem;
    font-weight:600;
    opacity:0;
    transform:translateY(10px);
    transition:opacity .3s ease, transform .3s ease;
    text-align: center;
    font-size: 1.5rem;
    padding-top: 1rem;
    word-break: break-word;
  }

  .lock-message.show{
    opacity:1;
    transform:translateY(0);
  }

  .lock-message.success{
    color:#28a745;
  }

  .lock-message.error{
    color:#ee0022;
  }
  @media (max-width: 500px) {
    .lock{
      margin-top: 5rem;
      align-items: flex-start;
    }
    .lock-zone {
      padding: 10px 20px;
      margin: 10px;
    }
  </style>
{{ end }}